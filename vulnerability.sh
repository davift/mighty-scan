##
## Vulnerability Phase
##

box_green "Attack Surface by Type"
mkdir -p $OUTPUT_DIR/vulnscan

# LINUX
LINUX="$OUTPUT_DIR/vulnscan/linux.ips"
echo -n '' > $LINUX
for HOST in $(egrep -v "^#|Status: Up" $OUTPUT_DIR/port.open | cut -d' ' -f2); do
  CHECK=$(egrep -v "^#|Status: Up" $OUTPUT_DIR/fingerprint/$HOST.nmap | grep 'OS: Linux')
  if [ "$CHECK" != "" ]; then
    echo $HOST >> $LINUX
  fi
done
COUNT=$(cat $LINUX | wc -l)
echo "--Linux-($COUNT)--"
tput setaf 4
cat $LINUX
tput sgr0

# WINDOWS
WINDOWS="$OUTPUT_DIR/vulnscan/windows.ips"
echo -n '' > $WINDOWS
for HOST in $(egrep -v "^#|Status: Up" $OUTPUT_DIR/port.open | cut -d' ' -f2); do
  CHECK=$(egrep -v "^#|Status: Up" $OUTPUT_DIR/fingerprint/$HOST.nmap | grep 'OS: Windows')
  if [ "$CHECK" != "" ]; then
    echo $HOST >> $WINDOWS
  fi
done
COUNT=$(cat $LINUX | wc -l)
echo "--Windows-($COUNT)--"
tput setaf 4
cat $WINDOWS
tput sgr0

# APPLE
APPLE="$OUTPUT_DIR/vulnscan/apple.ips"
echo -n '' > $APPLE
for HOST in $(egrep -v "^#|Status: Up" $OUTPUT_DIR/port.open | cut -d' ' -f2); do
  CHECK=$(egrep -v "^#|Status: Up" $OUTPUT_DIR/fingerprint/$HOST.nmap | grep 'OS: Apple')
  if [ "$CHECK" != "" ]; then
    echo $HOST >> $APPLE
  fi
done
COUNT=$(cat $APPLE | wc -l)
echo "--Apple-($COUNT)--"
tput setaf 4
cat $APPLE
tput sgr0

# SMB/CIFS
SMB="$OUTPUT_DIR/vulnscan/smb.ips"
egrep -v "^#|Status: Up" $OUTPUT_DIR/port.open | grep ' 139\|445/' | cut -d' ' -f2 > $SMB
COUNT=$(cat $SMB | wc -l)
echo "--SMB-($COUNT)--"
tput setaf 4
cat $SMB
tput sgr0

# NFS
NFS="$OUTPUT_DIR/vulnscan/nfs.ips"
egrep -v "^#|Status: Up" $OUTPUT_DIR/port.open | grep ' 111\|2049/' | cut -d' ' -f2 > $NFS
COUNT=$(cat $NFS | wc -l)
echo "--NFS-($COUNT)--"
tput setaf 4
cat $NFS
tput sgr0

# HTTP
HTTP="$OUTPUT_DIR/vulnscan/http.ips"
egrep -v "^#|Status: Up" $OUTPUT_DIR/port.open | grep ' 80\|443/' | cut -d' ' -f2 > $HTTP
COUNT=$(cat $HTTP | wc -l)
echo "--HTTP-($COUNT)--"
tput setaf 4
cat $HTTP
tput sgr0

# FTP
FTP="$OUTPUT_DIR/vulnscan/ftp.ips"
egrep -v "^#|Status: Up" $OUTPUT_DIR/port.open | grep ' 20\|21/' | cut -d' ' -f2 > $FTP
COUNT=$(cat $FTP | wc -l)
echo "--FTP-($COUNT)--"
tput setaf 4
cat $FTP
tput sgr0

# Scan options
read -e -p "Vuln Scripts: Linux (y/N): " OPT1
read -e -p "Vuln Scripts: Windows (y/N): " OPT2
read -e -p "Vuln Scripts: Apple (y/N): " OPT3
read -e -p "Vuln Scripts: SMB (y/N): " OPT4
read -e -p "Vuln Scripts: NFS (y/N): " OPT5
read -e -p "Vuln Scripts: HTTP (y/N): " OPT6
read -e -p "Vuln Scripts: FTP (y/N): " OPT7

